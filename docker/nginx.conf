user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

stream {
    upstream chat_backend {
        # 负载均衡策略：最少连接数 
        least_conn;
        
        # 这里填 docker-compose 中的服务名:容器内部端口
        server chat-server-1:8000;
        server chat-server-2:8000;
    }

    server {
        listen 8888;
        # 转发到上面的 upstream
        proxy_pass chat_backend;
    }
}